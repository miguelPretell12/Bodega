function tableAll(){const a=window.location.search,e=new URLSearchParams(a).get("id");$("#table_id").DataTable({destroy:!0,ajax:{method:"GET",url:"/supervisor/getAnotaciones?id="+e},columns:[{data:"categoria"},{data:"precio"},{data:"estado"},{data:"observacion"},{data:null,render:function(a,e,t){return`\n            <button class="btn btn-warning far fa-edit" data-idanotacion="${a.id}" id="edit" data-bs-toggle="modal" data-bs-target="#modalAnotacion" ></button>\n            <button class="btn btn-danger far fa-trash-alt" data-idanotacion="${a.id}" id="delete"></button>\n          `}}]})}function formulario(){$(document).on("submit","#formulario",(function(a){a.preventDefault();const e=$("#id").val(),t=$("#categoria").val(),n=$("#precio").val(),o=$("#capital").val(),i=$("#observacion").val(),r=new FormData;r.append("precio",n),r.append("idCapital",o),r.append("idCategoria",t),r.append("estado","pendiente"),r.append("observacion",i),""==e?create(r):(r.append("id",e),update(r))}))}function spinnerHide(a){document.querySelector("#spinner").style.display=a}function obtenerData(){$(document).on("click","#edit",(function(a){clean();const e=a.target.dataset.idanotacion,t=new FormData;t.append("id",e),getAnotacion(t)}))}function eliminarAnotacion(){$(document).on("click","#delete",(function(a){const e=a.target.dataset.idanotacion,t=new FormData;t.append("id",e),Swal.fire({title:"¿ Usted quiere eliminar esta anotación ?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si, deseo eliminar la anotacion"}).then(a=>{a.isConfirmed&&(remove(t),tableAll())})}))}async function getAnotacion(a){spinnerHide("flex");const e=await fetch(" /supervisor/getAnotacion",{method:"POST",body:a});e&&spinnerHide("none");const t=await e.json(),{id:n,precio:o,idCategoria:i,idCapital:r,observacion:c}=t.res;$("#categoria").val(i),$("#precio").val(o),$("#capital").val(r),$("#observacion").val(c),$("#id").val(n)}async function getCategorias(){const a=window.location.search,e=" /supervisor/getCategorias?id="+new URLSearchParams(a).get("id"),t=await fetch(e),n=await t.json(),o=document.querySelector("#categoria"),{data:i}=n;i.forEach(a=>{const e=document.createElement("option");e.value=a.id,e.textContent=a.nombre,o.appendChild(e)})}async function viewCapitalXCategoria(){const a=window.location.search,e=" /supervisor/viewCapitalXCategoria?id="+new URLSearchParams(a).get("id"),t=await fetch(e),n=await t.json();console.log(n);const{data:o}=n,i=document.querySelector("#capital");o.forEach(a=>{const e=document.createElement("option");e.value=a.id,e.textContent=`${a.capital} - Sede:${a.sede}`,i.appendChild(e)})}async function create(a){spinnerHide("flex");const e=await fetch(" /supervisor/createAnotacion",{method:"POST",body:a});e&&spinnerHide("none");(await e.json()).res?(Swal.fire("Exito!","Se guardo correctamente la anotacion","success"),tableAll(),"#modalAnotacion".modal("hide")):Swal.fire("Error!","Error al guardar","error")}async function update(a){spinnerHide("flex");const e=await fetch(" /supervisor/updateAnotacion",{method:"POST",body:a});e&&spinnerHide("none");(await e.json()).res?(Swal.fire("Exito!","Se edito correctamente la anotacion","success"),tableAll(),$("#modalAnotacion").modal("hide")):Swal.fire("Error!","Error al guardar","error")}async function remove(a){spinnerHide("flex");const e=await fetch(" /supervisor/deleteAnotacion",{method:"POST",body:a});e&&spinnerHide("none");(await e.json()).res?(Swal.fire("Exito!","Se elimino correctamente la anotacion","success"),tableAll()):Swal.fire("Error!","Error al eliminar","error")}function clean(){$("#categoria").val(""),$("#precio").val(""),$("#observacion").val(""),$("#id").val("")}$(document).ready((function(a){getCategorias(),viewCapitalXCategoria(),formulario(),tableAll(),obtenerData(),eliminarAnotacion()})),$(document).on("click","#btn-anotacion",(function(a){clean()}));