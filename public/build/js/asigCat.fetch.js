function tableAll(){$("#table_id").DataTable({destroy:!0,ajax:{method:"GET",url:"/dashboard/asignarCategoria/getAsignarCats"},columns:[{data:null,render:function(t,a,e){return`\n            ${t.sede} (${t.empresa})\n          `}},{data:"direccion"},{data:"categoria"},{data:null,render:function(t,a,e){return"H"==t.estado?`<button class="btn btn-success" id="status" data-idasig = "${t.id}">Habilitado</button>`:`<button class="btn btn-danger" id="status" data-idasig = "${t.id}">Inhabilitado</button>`}}]})}function formulario(){$(document).on("submit","#formulario",(function(t){t.preventDefault();const a=$("#sede").val(),e=$("#categoria").val(),o=$("#estado").val(),n=new FormData;n.append("idSede",a),n.append("idCategoria",e),n.append("estado",o),create(n)}))}function updateStatus(){$(document).on("click","#status",(function(t){const a=t.target.dataset.idasig,e="habilitado"==t.target.textContent.toLowerCase()?"H":"I",o=new FormData;o.append("id",a),o.append("estado",e),updateEstado(o)}))}async function create(t){spinnerHide("flex");const a=await fetch("http://localhost:4000/dashboard/asignarCategoria/create",{method:"POST",body:t});a&&spinnerHide("none");const e=await a.json(),{res:o,mensaje:n}=e;o?Swal.fire("Error!",n,"error"):Swal.fire("Exito!",n,"success")}async function updateEstado(t){spinnerHide("flex");const a=await fetch("http://localhost:4000/dashboard/asignarCategoria/updateStatus",{method:"POST",body:t});a&&(spinnerHide("none"),tableAll());const e=await a.json(),{res:o}=e;o?Swal.fire("Exito!","Se pudo cambiar el estado correctamente","success"):Swal.fire("Error!","Hubo un error al cambiar el estado","error")}async function getCategorias(){const t=await fetch("http://localhost:4000/dashboard/categorias/getCategorias"),a=await t.json(),{data:e}=a,o=document.querySelector("#categoria");e.forEach(t=>{const{id:a,nombre:e}=t,n=document.createElement("option");n.value=a,n.textContent=e,o.appendChild(n)})}async function getSedes(){const t=await fetch("http://localhost:4000//dashboard/sedes/getSedes"),a=await t.json(),{data:e}=a,o=document.querySelector("#sede");e.forEach(t=>{const{id:a,nombre:e,empresa:n}=t,s=document.createElement("option");s.value=a,s.textContent=`${e} (${n})`,o.appendChild(s)})}function spinnerHide(t){document.querySelector("#spinner").style.display=t}$(document).ready((function(t){tableAll(),getCategorias(),getSedes(),formulario(),updateStatus()}));