function tableAll(){$("#table_id").DataTable({destroy:!0,ajax:{method:"GET",url:"/empleado/getCapitales"},columns:[{data:"capital"},{data:null,render:function(a,e,t){return`${a.sede} (${a.empresa})`}},{data:"fecha"},{data:null,render:function(a,e,t){const o=new Date,n=o.getDate(),i=o.getMonth()+1,l=i<=9?0+i:i;return`\n                <button class="btn btn-warning far fa-edit"\n                style = "display: ${`${o.getFullYear()}-0${l}-${n}`!=a.fecha?"none":"inline-block"} "\n                data-idcapital="${a.idCapital}" id="edit" data-bs-toggle="modal" data-bs-target="#modalCapital">\n                </button>\n                <a class="btn btn-success far fa-eye" href="/empleado/viewCapital?id=${a.idCapital}"></a>\n            `}}]})}function tableViewCapital(){$("#table_anotacion").DataTable({destroy:!0,ajax:{method:"GET",url:"/empleado/getViewCategorias"},columns:[{data:"categoria"},{data:"precio"},{data:"estado"},{data:"observacion"}]})}function obtenerData(){$(document).on("click","#edit",(function(a){const e=a.target.dataset.idcapital,t=new FormData;t.append("id",e),getCapitalEmpleado(t)}))}function formulario(){$(document).on("submit","#formulario",(function(a){a.preventDefault();const e=$("#id").val(),t=$("#capital").val(),o=$("#sede").val(),n=new FormData;n.append("precio",t),n.append("idSede",o),""==e?createCapital(n):(n.append("id",e),update(n))}))}function formularioAn(){$(document).on("submit","#formularioA",(function(a){a.preventDefault();const e=$("#categoria").val(),t=$("#precio").val(),o=$("#capital").val(),n=$("#observacion").val(),i=new FormData;i.append("idCategoria",e),i.append("precio",t),i.append("idCapital",o),i.append("observacion",n),i.append("estado","pendiente"),createAnotacion(i)}))}async function getCapitalEmpleado(a){spinnerHide("flex");const e=await fetch("http://localhost:4000/empleado/getCapital",{method:"POST",body:a});e&&spinnerHide("none");const t=await e.json(),{data:o}=t,n=document.querySelector("#sede");o.forEach(a=>{const{capital:e,sede:t,idSede:o,idCapital:i,empresa:l}=a;$("#id").val(i),$("#capital").val(e);const c=document.createElement("option");c.value=o,c.textContent=`${t} (${l})`,n.appendChild(c)})}async function update(a){spinnerHide("flex");const e=await fetch("http://localhost:4000/empleado/updateCapital",{method:"POST",body:a});e&&spinnerHide("none");const t=await e.json(),{res:o}=t;o?(Swal.fire("Exito!!","Se edito correctamente","success"),tableAll()):Swal.fire("Error!!","Hubo un error al editar","error")}async function getCategorias(){const a=window.location.search,e="http://localhost:4000/empleado/getCategorias?id="+new URLSearchParams(a).get("id"),t=await fetch(e),o=await t.json(),n=document.querySelector("#categoria"),{categoria:i}=o;i.forEach(a=>{const{id:e,nombre:t}=a,o=document.createElement("option");o.value=e,o.textContent=t,n.appendChild(o)})}async function getCapital(){const a=window.location.search,e="http://localhost:4000/empleado/getCapitalE?capital="+new URLSearchParams(a).get("id"),t=await fetch(e),o=await t.json(),n=document.querySelector("#capital"),{cap:i}=o;i.forEach(a=>{const{id:e,sede:t,capital:o,fecha:i}=a,l=document.createElement("option");l.value=e,l.textContent=`Capital: ${o} - Sede: ${t}`,n.appendChild(l)})}async function createAnotacion(a){const e=await fetch("http://localhost:4000/empleado/createAnotacion",{method:"POST",body:a}),t=await e.json(),{resultado:o}=t.resp;o?(Swal.fire("Exito!","Se guardo exitosamente","success"),$("#modalAnotacion").modal("hide"),tableViewCapital()):Swal.fire("Error!","Error al guardar!","error")}async function getSedeXEmpleado(){const a=await fetch("http://localhost:4000/empleado/getSedeXEmpleado"),e=await a.json(),{data:t}=e,o=document.querySelector("#sede"),{id:n,nombre:i,empresa:l,direccion:c}=t,d=document.createElement("option");d.value=n,d.textContent=`${i} (${l})`,o.appendChild(d)}function spinnerHide(a){document.querySelector("#spinner").style.display=a}async function createCapital(a){spinnerHide("flex");const e=await fetch("http://localhost:4000/empleado/createCapital",{method:"POST",body:a}),t=await e.json();e&&spinnerHide("none");const{res:o,mensaje:n}=t;o?(Swal.fire("Exito!!",n,"success"),tableAll(),$("#modalCapital").modal("hide")):Swal.fire("Error!!",n,"error")}function cleanCapital(){$("#id").val(""),$("#capital").val("")}$(document).ready((function(){tableAll(),tableViewCapital(),obtenerData(),formulario(),formularioAn(),getCategorias(),getCapital(),getSedeXEmpleado()})),$(document).on("click","#btn-capital",(function(a){cleanCapital()}));