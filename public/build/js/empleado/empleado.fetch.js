function tableAll(){$("#table_id").DataTable({destroy:!0,ajax:{method:"GET",url:"/empleado/getCapitales"},columns:[{data:"capital"},{data:null,render:function(a,e,t){return`${a.sede} (${a.empresa})`}},{data:"fecha"},{data:null,render:function(a,e,t){const n=new Date,o=n.getDate(),i=n.getMonth()+1,l=i<=9?0+i:i;return`\n                <button class="btn btn-warning far fa-edit"\n                style = "display: ${`${n.getFullYear()}-0${l}-${o}`!=a.fecha?"none":"inline-block"} "\n                data-idcapital="${a.idCapital}" id="edit" data-bs-toggle="modal" data-bs-target="#modalCapital">\n                </button>\n                <a class="btn btn-success far fa-eye" href="/empleado/viewCapital?id=${a.idCapital}"></a>\n            `}}]})}function tableViewCapital(){$("#table_anotacion").DataTable({destroy:!0,ajax:{method:"GET",url:"/empleado/getViewCategorias"},columns:[{data:"categoria"},{data:"precio"},{data:"estado"},{data:"observacion"}]})}function obtenerData(){$(document).on("click","#edit",(function(a){const e=a.target.dataset.idcapital,t=new FormData;t.append("id",e),getCapitalEmpleado(t)}))}function formulario(){$(document).on("submit","#formulario",(function(a){a.preventDefault();const e=$("#id").val(),t=$("#capital").val(),n=$("#sede").val(),o=new FormData;o.append("precio",t),o.append("idSede",n),""==e?createCapital(o):(o.append("id",e),update(o))}))}function formularioAn(){$(document).on("submit","#formularioA",(function(a){a.preventDefault();const e=$("#categoria").val(),t=$("#precio").val(),n=$("#capital").val(),o=$("#observacion").val(),i=new FormData;i.append("idCategoria",e),i.append("precio",t),i.append("idCapital",n),i.append("observacion",o),i.append("estado","pendiente"),createAnotacion(i)}))}async function getCapitalEmpleado(a){spinnerHide("flex");const e=await fetch(" /empleado/getCapital",{method:"POST",body:a});e&&spinnerHide("none");const t=await e.json(),{data:n}=t,o=document.querySelector("#sede");n.forEach(a=>{const{capital:e,sede:t,idSede:n,idCapital:i,empresa:l}=a;$("#id").val(i),$("#capital").val(e);const c=document.createElement("option");c.value=n,c.textContent=`${t} (${l})`,o.appendChild(c)})}async function update(a){spinnerHide("flex");const e=await fetch(" /empleado/updateCapital",{method:"POST",body:a});e&&spinnerHide("none");const t=await e.json(),{res:n}=t;n?(Swal.fire("Exito!!","Se edito correctamente","success"),tableAll()):Swal.fire("Error!!","Hubo un error al editar","error")}async function getCategorias(){const a=window.location.search,e=" /empleado/getCategorias?id="+new URLSearchParams(a).get("id"),t=await fetch(e),n=await t.json(),o=document.querySelector("#categoria"),{categoria:i}=n;i.forEach(a=>{const{id:e,nombre:t}=a,n=document.createElement("option");n.value=e,n.textContent=t,o.appendChild(n)})}async function getCapital(){const a=window.location.search,e=" /empleado/getCapitalE?capital="+new URLSearchParams(a).get("id"),t=await fetch(e),n=await t.json(),o=document.querySelector("#capital"),{cap:i}=n;i.forEach(a=>{const{id:e,sede:t,capital:n,fecha:i}=a,l=document.createElement("option");l.value=e,l.textContent=`Capital: ${n} - Sede: ${t}`,o.appendChild(l)})}async function createAnotacion(a){const e=await fetch(" /empleado/createAnotacion",{method:"POST",body:a}),t=await e.json(),{resultado:n}=t.resp;n?(Swal.fire("Exito!","Se guardo exitosamente","success"),$("#modalAnotacion").modal("hide"),tableViewCapital()):Swal.fire("Error!","Error al guardar!","error")}async function getSedeXEmpleado(){const a=await fetch(" /empleado/getSedeXEmpleado"),e=await a.json(),{data:t}=e,n=document.querySelector("#sede"),{id:o,nombre:i,empresa:l,direccion:c}=t,d=document.createElement("option");d.value=o,d.textContent=`${i} (${l})`,n.appendChild(d)}function spinnerHide(a){document.querySelector("#spinner").style.display=a}async function createCapital(a){spinnerHide("flex");const e=await fetch(" /empleado/createCapital",{method:"POST",body:a}),t=await e.json();e&&spinnerHide("none");const{res:n,mensaje:o}=t;n?(Swal.fire("Exito!!",o,"success"),tableAll(),$("#modalCapital").modal("hide")):Swal.fire("Error!!",o,"error")}function cleanCapital(){$("#id").val(""),$("#capital").val("")}$(document).ready((function(){tableAll(),tableViewCapital(),obtenerData(),formulario(),formularioAn(),getCategorias(),getCapital(),getSedeXEmpleado()})),$(document).on("click","#btn-capital",(function(a){cleanCapital()}));